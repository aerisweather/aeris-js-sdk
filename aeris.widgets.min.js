!function(){var a=this,b=a.jQuery,c=a.Aeris;if(!c)throw"AerisException";c.provide("Aeris.widgets"),c.widgets.Currents=c.Widget.extend({prefix:"currents",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-currents"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{#advisories}}<div class="aeris-widget-currents-advblock"><span class="aeris-widget-currents-adv">{{details.name}}</span></div>{{/advisories}}<div class="aeris-widget-bottom"><div class="aeris-widget-currents-wxblock"><div class="aeris-widget-currents-icon{{#observations.0.ob.isDay}} aeris-widget-currents-icon-day{{/observations.0.ob.isDay}}"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-currents-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div></div><div class="aeris-widget-currents-detblock"><div class="aeris-widget-currents-wx">{{observations.0.ob.weatherShort}}</div><ul><li><p class="aeris-widget-currents-detail-label">Feels Like</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.feelslikeC}}{{else}}{{observations.0.ob.feelslikeF}}{{/if}}&deg;</p></li><li><p class="aeris-widget-currents-detail-label">Winds</p><p class="aeris-widget-currents-detail-value">{{observations.0.ob.windDir}} {{#if metric}}{{observations.0.ob.windKPH}} kmh{{else}}{{observations.0.ob.windMPH}} mph{{/if}}</p></li><li><p class="aeris-widget-currents-detail-label">Dew Point</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.dewpointC}}{{else}}{{observations.0.ob.dewpointF}}{{/if}}&deg;</p></li><li><p class="aeris-widget-currents-detail-label">Humidity</p><p class="aeris-widget-currents-detail-value">{{observations.0.ob.humidity}}%</p></li><li><p class="aeris-widget-currents-detail-label">Pressure</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.pressureMB}} mb{{else}}{{observations.0.ob.pressureIN}} in{{/if}}</p></li></ul></div></div></div></div>'},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES,params:{p:this.params.p}},{endpoint:c.endpoints.OBS,params:{p:this.params.p}},{endpoint:c.endpoints.ADVISORIES,params:{p:this.params.p}}],{})}},_afterRender:function(){var b=this.$(".aeris-widget-bottom").width(),c=this.$(".aeris-widget-currents-wxblock"),d=this.$(".aeris-widget-currents-detblock"),e=b-c.outerWidth(!0)-parseInt(c.css("left"),10)-parseInt(d.css("right"),10)-10;d.css({width:e})}}),c.widgets.CurrentsCompact=c.Widget.extend({prefix:"currents-compact",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-currents-compact"><div class="aeris-widget-inner"><div class="aeris-widget-currents-compact-icon"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-currents-compact-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;</div>{{#advisories}}<div class="aeris-widget-currents-compact-alert"></div>{{/advisories}}</div></div>'},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES},{endpoint:c.endpoints.OBS},{endpoint:c.endpoints.ADVISORIES}],{p:this.params.p})}}}),c.widgets.ShortTermOutlookCompact=c.Widget.extend({prefix:"24hr-compact",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-24hr-compact"><div class="aeris-widget-inner"><div class="aeris-widget-24hr-compact-now"><div class="aeris-widget-24hr-compact-pad"><div class="aeris-widget-24hr-compact-title">Currently</div><div class="aeris-widget-24hr-compact-icon"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-24hr-compact-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;</div>{{#advisories}}<div class="aeris-widget-currents-compact-alert"></div>{{/advisories}}</div></div><div class="aeris-widget-24hr-compact-periods">{{#forecasts.0.periods}}<div class="aeris-widget-24hr-compact-period"><div class="aeris-widget-24hr-compact-title">{{timeofday validTime}}</div><div class="aeris-widget-24hr-compact-pad"><div class="aeris-widget-24hr-compact-icon"><img src="{{../paths.wxicons}}{{icon}}" /></div><div class="aeris-widget-24hr-compact-temp">{{minmax this ../metric}}&deg;</div></div></div>{{/forecasts.0.periods}}</div></div></div>',helpers:{minmax:function(a,b){return a.isDay===!0?b?a.maxTempC:a.maxTempF:b?a.minTempC:a.minTempF}}},params:{filter:"daynight",limit:2}},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.OBS,params:{p:this.params.p}},{endpoint:c.endpoints.ADVISORIES,params:{p:this.params.p}},{endpoint:c.endpoints.FORECASTS,params:b.extend(!0,{limit:2,filter:"daynight"},this.params)}],{})}},_afterRender:function(){this.$(".aeris-widget-24hr-compact-period:last").addClass("aeris-widget-24hr-compact-period-last")}}),c.widgets.Forecast=c.Widget.extend({prefix:"fcst",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-fcst"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><div class="aeris-widget-fcst-periods"><ul>{{#forecasts.0.periods}}<li><p class="aeris-widget-fcst-period-name">{{#if ../isHourly}}{{hourformat validTime}}{{else}}{{dayformat validTime}}{{/if}}</p><p class="aeris-widget-fcst-period-icon"><img src="{{../paths.wxicons}}{{icon}}" /></p>{{#if ../isHourly}}<p class="aeris-widget-fcst-period-hi">{{#if ../../metric}}{{tempC}}{{else}}{{tempF}}{{/if}}&deg;</p>{{else}}<p class="aeris-widget-fcst-period-hi">{{#if ../../metric}}{{maxTempC}}{{else}}{{maxTempF}}{{/if}}&deg;</p><p class="aeris-widget-fcst-period-lo">{{#if ../../metric}}{{minTempC}}{{else}}{{minTempF}}{{/if}}&deg;</p>{{/if}}</li>{{/forecasts.0.periods}}</ul></div></div></div></div>',helpers:{dayformat:function(a){var c,b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if("string"==typeof a){var d=a.split(/-|\+|\s+|:|T/);c=new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5],0)}else c=new Date(1e3*a);return b[c.getDay()].substr(0,3)},hourformat:function(a){if("string"==typeof a){var b=a.split(/-|\+|\s+|:|T/);d=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5],0)}else d=new Date(1e3*a);var c=d.getHours(),e=c>=12?"p":"a";return c>12?c-=12:0===c&&(c=12),c+e},periodformat:function(){}}},opts:{resize:{col:{autocalc:!0}}}},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES,params:{p:this.params.p}},{endpoint:c.endpoints.FORECASTS,params:b.extend(!0,{limit:7},this.params)}],{})}},_beforeRender:function(a){a.isHourly=!1,a.isDayNight=!1,a.params.filter&&(a.isHourly="day"!==a.params.filter&&"daynight"!==a.params.filter,a.isDayNight="daynight"!==a.params.filter)},_afterRender:function(){if(this.opts.resize.col.autocalc!==!1){var a=this.$(".aeris-widget-fcst-periods > ul > li"),d=this.$(".aeris-widget-inner").width(),e=Math.floor(d/a.length),f=cw=0;e>0&&c._.each(a,function(a){var c=b(a);cw=e-(c.outerWidth()-c.width()),c.css({width:cw}),f+=c.outerWidth()}),d>0&&d>f&&this.$(".aeris-widget-fcst-periods > ul > li:last").css({width:cw+(d-f)})}}}),c.widgets.NearbyWeather=c.Widget.extend({prefix:"nearbywx",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-nearbywx"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">Nearby Weather</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul class="aeris-widget-nearbywx-listing">{{#locations}}<li><div class="aeris-widget-nearbywx-name"><a href="{{../links.wxlocal}}?pands={{lower places.place.name}},{{#if places.place.state}}{{lower places.place.state}}{{else}}{{lower places.place.country}}{{/if}}">{{places.place.name}}{{#if places.place.state}}, {{places.place.state}}{{/if}}</a></div><div class="aeris-widget-nearbywx-temp">{{#if ../metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if ../metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-nearbywx-icon"><img src="{{../paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-nearbywx-detail">Feels Like {{#if ../metric}}{{observations.0.ob.feelslikeC}}{{else}}{{observations.0.ob.feelslikeF}}{{/if}}&deg;</div>{{#if advisories}}<a class="aeris-widget-nearbywx-alerts" href="{{../../links.wxlocal}}local/{{lower places.place.country}}/{{lower places.place.state}}/{{lower places.place.name}}/warnings.html"><div class="aeris-widget-nearbywx-count">{{advisories.length}}</div><div class="aeris-widget-nearbywx-label">active alerts</div></a>{{/if}}</li>{{/locations}}</ul></div></div></div>'},places:[],placesData:[],setUnits:function(a){a!=this.opts.units&&(this.opts.units=a,this.render({locations:this.placesData}))},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Places,this.collection.bind("load",function(b){a.hideLoader();var d=[];a.places.length=0,c._.each(b.models,function(b){a.places.push(b.get("place.name")+","+b.get("place.state")+","+b.get("place.country")),d.push({places:b.toJSON(),observations:[{ob:{icon:"na.png"}}]})}),a.render({locations:d}),a.placesData=d,a._loadWxData(b)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch(c.actions.CLOSEST,this.params)}},_loadWxData:function(a){var b=this,d={};locData=[];for(var e=0,f=0,g=this.places.length;g>f;f++){var h=this.places[f],i=new c.collections.Batch;d[i.cid]=f,i.bind("load",function(f){var h=d[f.cid],i=c._.extend({},{places:a.at(h).toJSON()},f.toJSON().data);locData[h]=i,e++,e===g&&(b.placesData=locData,b.hideLoader(),b.render({locations:locData}))}),i.bind("loaderror",function(a,c,d){b.hideLoader(),b.showError(d,2e3)}),i.fetch([{endpoint:c.endpoints.OBS,action:c.actions.ID,params:{p:h}},{endpoint:c.endpoints.ADVISORIES,action:c.actions.ID,params:{p:h}}],{})}}}),c.widgets.Advisories=c.Widget.extend({prefix:"advisories",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-advisories"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul class="aeris-widget-advisories-listing">{{#if advisories}}{{#advisories}}<li><p class="aeris-widget-advisories-name">{{ucwords details.name}}</p><p class="aeris-widget-advisories-expires">expires {{dateformat timestamps.expiresISO}}</p><div class="aeris-widget-advisories-icon aeris-widget-advisories-icon-{{alerttype details.type}}"></div></li>{{/advisories}}{{else}}<li class="aeris-widget-error">There are currently no active advisories.</li>{{/if}}</ul></div></div></div>',helpers:{alerttype:function(a){var b="adv";return a+="",a.match(/\.W$/)?b="warn":a.match(/\.A$/)&&(b="watch"),b},dateformat:function(a){var d,b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","Decemeber"];if(a+="","string"==typeof a){var e=a.split(/-|\+|\s+|:|T/);d=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5],0)}else d=new Date(1e3*a);if(d){var f=d.getHours(),g=String("00000"+d.getMinutes()).slice(-2),h=f>=12?"pm":"am";f>12&&(f-=12),0===f&&(f=12);var i=b[d.getDay()]+"",j=c[d.getMonth()]+"";return i.substr(0,3)+", "+j.substr(0,3)+" "+d.getDate()+" at "+f+":"+g+h}}}}},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES,params:{p:this.params.p}},{endpoint:c.endpoints.ADVISORIES,params:b.extend(!0,{},this.params)}],{})}}}),c.widgets.StormReports=c.Widget.extend({prefix:"stmreports",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-stmreports"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}{{> filters}}<div class="aeris-widget-stmreports-listing">{{#if stormreports}}<ul>{{#stormreports}}{{> row}}{{/stormreports}}</ul>{{else}}<div class="aeris-widget-error">No storm reports for the selected type found.</div>{{/if}}</div></div></div>',partials:{row:'<li><div class="aeris-widget-stmreports-icon aeris-widget-stmreports-icon-code-{{report.code}}"></div><div class="aeris-widget-stmreports-profile"><div class="aeris-widget-stmreports-name">{{ucwords report.type}}<span class="aeris-widget-stmreports-total">{{total report.detail metric}}</span></div><div class="aeris-widget-stmreports-details">{{ucwords place.name}}, {{upper place.state}} - {{dateformat report.datetime}}</div></div></li>',filters:'<div class="aeris-widget-stmreports-ctrl"><ul><li class="filter-all"><a>All</a></li><li class="filter-tornado"><a>Tornado</a></li><li class="filter-rain"><a>Rain</a></li><li class="filter-wind"><a>Wind</a></li><li class="filter-snow"><a>Snow</a></li><li class="filter-hail"><a>Hail</a></li><li class="filter-ice"><a>Ice</a></li></ul></div>'},helpers:{total:function(a){var c="";return a=a||{},a.snowIN?c=a.snowIN+'"':a.rainIN?c=a.rainIN+'"':a.windSpeedMPH&&(c=a.windSpeedMPH+" mph"),""!==c?" - "+c:""},dateformat:function(a){var b;if(a+="","string"==typeof a){var c=a.split(/-|\+|\s+|:|T/);b=new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5],0)}else b=new Date(1e3*a);var d=b.getFullYear(),e=b.getMonth(),f=b.getDate(),g=b.getHours(),h=b.getMinutes(),i=g>=12?"pm":"am";return g=g>12?g-12:0===g?12:g,h=10>h?"0"+h:h,e+1+"/"+f+"/"+d+" at "+g+":"+h+i}}},updates:{target:".aeris-widget-stmreports-listing"},params:{limit:50}},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES,params:{p:this.params.p}},{endpoint:c.endpoints.STMREPORTS,action:c.actions.CLOSEST,params:b.extend(!0,{limit:50},this.params)}],{})}},filter:function(a){this.$(".aeris-widget-stmreports-ctrl li").removeClass("sel"),this.$(".aeris-widget-stmreports-ctrl li.filter-"+a).addClass("sel"),this.params.filter="all"!=a?a:null,this.collection.reset(),this.load()},_afterRender:function(){var c=this,d=this.params.filter||"all";this.$(".aeris-widget-stmreports-ctrl li.filter-"+d).addClass("sel"),this.$(".aeris-widget-stmreports-ctrl li").click(function(a){var d=a.currentTarget,e=b(d).attr("class").replace(/^filter-(\w+)( sel)?$/,"$1");c.filter(e)})},_afterUpdate:function(a){var b=this.view.snippet(".aeris-widget-title"),c=Handlebars.compile(b),d=c(a),e=this.$(".aeris-widget-title");e.html()!=d&&e.fadeOut(100,function(){e.html(c(a)),e.fadeIn(100)})}}),c.widgets.TempExtremes=c.Widget.extend({prefix:"currents-compact",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-tempextremes"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{ucwords countries.0.place.name}}</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul><li class="aeris-widget-tempextremes-max"><div class="aeris-widget-tempextremes-label">Highest Temp</div><div class="aeris-widget-tempextremes-icon"></div><div class="aeris-widget-tempextremes-profile">{{#if observations.0.ob}}<div class="aeris-widget-tempextremes-val">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-tempextremes-name">{{ucwords observations.0.place.name}}}{{#if observations.0.place.state}}, {{upper observations.0.place.state}}{{/if}}</div>{{else}}<div class="aeris-widget-tempextremes-error">No observation found.</div>{{/if}}</div></li><li class="aeris-widget-tempextremes-min"><div class="aeris-widget-tempextremes-label">Lowest Temp</div><div class="aeris-widget-tempextremes-icon"></div><div class="aeris-widget-tempextremes-profile">{{#if observations.1.ob}}<div class="aeris-widget-tempextremes-val">{{#if metric}}{{observations.1.ob.tempC}}{{else}}{{observations.1.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-tempextremes-name">{{ucwords observations.1.place.name}}{{#if observations.1.place.state}}, {{upper observations.1.place.state}}{{/if}}</div>{{else}}<div class="aeris-widget-tempextremes-error">No observation found.</div>{{/if}}</div></li></ul></div></div></div>',partials:{search:'<div class="aeris-widget-search"><label>Country</label><input type="text" name="aeris-tempextremes-search" /></div>'},helpers:{ucwords:function(a){return a=(a+"").toLowerCase(),a=a.replace(/,.+$/,""),(a+"").replace(/^([a-z])|\s+([a-z])|\/([a-z])|(\-[a-z])/g,function(a){return a.toUpperCase()})}}},opts:{country:"us",toolbar:{geolocate:!1}}},load:function(){this.showLoader();var a=this,b="country:"+this.opts.country;this.params.query&&(b+=this.params.query),this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)}),this.collection.bind("collectionerror",function(){})),this.collection.fetch([{endpoint:c.endpoints.OBS,action:c.actions.SEARCH,params:{sort:"temp:-1",limit:1,query:b+",temp:-999"}},{endpoint:c.endpoints.OBS,action:c.actions.SEARCH,params:{sort:"temp",limit:1,query:b+",temp:-999"}},{endpoint:c.endpoints.COUNTRIES,params:{p:this.opts.country}}],{})},_afterRender:function(){var d=this,e=this.$(".aeris-widget-bottom > ul > li").width(),f=this.$(".aeris-widget-bottom > ul > li .aeris-widget-tempextremes-icon").outerWidth(!0);if(this.$(".aeris-widget-bottom > ul > li .aeris-widget-tempextremes-profile").width(e-f),this.$(".aeris-widget-search").is("*")){var g=new c.collections.Countries;this.$(".aeris-widget-search input").autocomplete({source:function(a,d){g.fetch(c.actions.SEARCH,{query:"name:^"+a.term+";iso:"+a.term+";iso3:"+a.term,limit:10}),g.bind("load",function(a){d(b.map(a.toJSON().models,function(a){return{label:a.place.name,value:a.place.iso}}))})},minLength:2,appendTo:this.content,select:function(a,b){b.item&&(d.$(".aeris-widget-search input").val(b.item.label),d.opts.country=b.item.value,d.reload())}})}}}),c.widgets.Records=c.Widget.extend({prefix:"records",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-records"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}{{> filters}}<div class="aeris-widget-records-listing">{{#if records}}<ul>{{#records}}{{> row}}{{/records}}</ul>{{else}}<div class="aeris-widget-error">No records for the selected type found.</div>{{/if}}</div></div></div>',partials:{row:'<li><div class="aeris-widget-records-icon aeris-widget-records-icon-type-{{report.type}}"></div><div class="aeris-widget-records-profile"><div class="aeris-widget-records-name">{{typename report.type}}<span class="aeris-widget-records-total">{{total this this.metric}}</span></div><div class="aeris-widget-records-details">{{ucwords place.name}}, {{upper place.state}} - {{dateformat report.timestamp}}</div></div></li>',filters:'<div class="aeris-widget-records-ctrl"><ul><li class="filter-all"><a>All</a></li><li class="filter-prcp"><a>Precip</a></li><li class="filter-snow"><a>Snow</a></li><li class="filter-maxt"><a>High</a></li><li class="filter-mint"><a>Low</a></li><li class="filter-lomx"><a>Cool High</a></li><li class="filter-himn"><a>Warm Low</a></li></ul></div>'},helpers:{typename:function(a){var b="";return b="maxt"==a?"High Temp":"mint"==a?"Low Temp":"prcp"==a?"Precip":"snow"==a?"Snow":"lomx"==a?"Cool High Temp":"himn"==a?"Warm Low Temp":a},total:function(a){var c="";return a=a||{},a.report&&a.report.details&&(a=a.report.details,void 0!==a.snowIN?c=a.snowIN+'"':void 0!==a.rainIN?c=a.rainIN+'"':void 0!==a.tempF&&(c=a.tempF+"&deg;F")),""!==c?" - "+c:""},dateformat:function(a){var b;if(a+="","string"==typeof a&&a.indexOf(":")>-1){var c=a.split(/-|\+|\s+|:|T/);b=new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5],0)}else b=new Date(1e3*a);var d=b.getFullYear(),e=b.getMonth(),f=b.getDate();return e+1+"/"+f+"/"+d}}},updates:{target:".aeris-widget-records-listing"},params:{limit:50}},load:function(){if(!this._geo()){this.showLoader();var a=this;this.collection||(this.collection=new c.collections.Batch,this.collection.bind("load",function(b){a.hideLoader(),a.render(b.toJSON().data)}),this.collection.bind("loaderror",function(b,c,d){a.hideLoader(),a.showError(d,2e3)})),this.collection.fetch([{endpoint:c.endpoints.PLACES,params:{p:this.params.p}},{endpoint:c.endpoints.RECORDS,action:c.actions.CLOSEST,params:this.params}],{})}},filter:function(a){this.$(".aeris-widget-records-ctrl li").removeClass("sel"),this.$(".aeris-widget-records-ctrl li.filter-"+a).addClass("sel"),this.params.filter="all"!=a?a:null,this.collection.reset(),this.load()},_afterRender:function(){var c=this,d=this.params.filter||"all";this.$(".aeris-widget-records-ctrl li.filter-"+d).addClass("sel"),this.$(".aeris-widget-records-ctrl li").click(function(a){var d=a.currentTarget,e=b(d).attr("class").replace(/^filter-(\w+)( sel)?$/,"$1");c.filter(e)})},_afterUpdate:function(a){var b=this.view.snippet(".aeris-widget-title"),c=Handlebars.compile(b),d=c(a),e=this.$(".aeris-widget-title");e.html()!=d&&e.fadeOut(100,function(){e.html(c(a)),e.fadeIn(100)})}})}.call(this);