(function(){var b=this;var c=b.jQuery;var a=b.Aeris;if(!a){throw"AerisException"}a.provide("Aeris.widgets");a.widgets.Currents=a.Widget.extend({prefix:"currents",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-currents"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{#advisories}}<div class="aeris-widget-currents-advblock"><span class="aeris-widget-currents-adv">{{details.name}}</span></div>{{/advisories}}<div class="aeris-widget-bottom"><div class="aeris-widget-currents-wxblock"><div class="aeris-widget-currents-icon{{#observations.0.ob.isDay}} aeris-widget-currents-icon-day{{/observations.0.ob.isDay}}"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-currents-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div></div><div class="aeris-widget-currents-detblock"><div class="aeris-widget-currents-wx">{{observations.0.ob.weatherShort}}</div><ul><li><p class="aeris-widget-currents-detail-label">Feels Like</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.feelslikeC}}{{else}}{{observations.0.ob.feelslikeF}}{{/if}}&deg;</p></li><li><p class="aeris-widget-currents-detail-label">Winds</p><p class="aeris-widget-currents-detail-value">{{observations.0.ob.windDir}} {{#if metric}}{{observations.0.ob.windKPH}} kmh{{else}}{{observations.0.ob.windMPH}} mph{{/if}}</p></li><li><p class="aeris-widget-currents-detail-label">Dew Point</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.dewpointC}}{{else}}{{observations.0.ob.dewpointF}}{{/if}}&deg;</p></li><li><p class="aeris-widget-currents-detail-label">Humidity</p><p class="aeris-widget-currents-detail-value">{{observations.0.ob.humidity}}%</p></li><li><p class="aeris-widget-currents-detail-label">Pressure</p><p class="aeris-widget-currents-detail-value">{{#if metric}}{{observations.0.ob.pressureMB}} mb{{else}}{{observations.0.ob.pressureIN}} in{{/if}}</p></li></ul></div></div></div></div>'},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES,params:{p:this.params.p}},{endpoint:a.endpoints.OBS,params:{p:this.params.p}},{endpoint:a.endpoints.ADVISORIES,params:{p:this.params.p}}],{})},_afterRender:function(h){var i=this.$(".aeris-widget-bottom").width();var f=this.$(".aeris-widget-currents-wxblock");var g=this.$(".aeris-widget-currents-detblock");var e=i-f.outerWidth(true)-parseInt(f.css("left"),10)-parseInt(g.css("right"),10)-10;g.css({width:e})}});a.widgets.CurrentsCompact=a.Widget.extend({prefix:"currents-compact",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-currents-compact"><div class="aeris-widget-inner"><div class="aeris-widget-currents-compact-icon"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-currents-compact-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;</div>{{#advisories}}<div class="aeris-widget-currents-compact-alert"></div>{{/advisories}}</div></div>'},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES},{endpoint:a.endpoints.OBS},{endpoint:a.endpoints.ADVISORIES}],{p:this.params.p})}});a.widgets.ShortTermOutlookCompact=a.Widget.extend({prefix:"24hr-compact",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-24hr-compact"><div class="aeris-widget-inner"><div class="aeris-widget-24hr-compact-now"><div class="aeris-widget-24hr-compact-pad"><div class="aeris-widget-24hr-compact-title">Currently</div><div class="aeris-widget-24hr-compact-icon"><img src="{{paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-24hr-compact-temp">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;</div>{{#advisories}}<div class="aeris-widget-currents-compact-alert"></div>{{/advisories}}</div></div><div class="aeris-widget-24hr-compact-periods">{{#forecasts.0.periods}}<div class="aeris-widget-24hr-compact-period"><div class="aeris-widget-24hr-compact-title">{{timeofday validTime}}</div><div class="aeris-widget-24hr-compact-pad"><div class="aeris-widget-24hr-compact-icon"><img src="{{../paths.wxicons}}{{icon}}" /></div><div class="aeris-widget-24hr-compact-temp">{{minmax this ../metric}}&deg;</div></div></div>{{/forecasts.0.periods}}</div></div></div>',helpers:{minmax:function(e,f){if(e.isDay===true){return(f?e.maxTempC:e.maxTempF)}return(f?e.minTempC:e.minTempF)}}},params:{filter:"daynight",limit:2}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.OBS,params:{p:this.params.p}},{endpoint:a.endpoints.ADVISORIES,params:{p:this.params.p}},{endpoint:a.endpoints.FORECASTS,params:c.extend(true,{limit:2,filter:"daynight"},this.params)}],{})},_afterRender:function(e){this.$(".aeris-widget-24hr-compact-period:last").addClass("aeris-widget-24hr-compact-period-last")}});a.widgets.Forecast=a.Widget.extend({prefix:"fcst",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-fcst"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><div class="aeris-widget-fcst-periods"><ul>{{#forecasts.0.periods}}<li><p class="aeris-widget-fcst-period-name">{{#if ../isHourly}}{{hourformat validTime}}{{else}}{{dayformat validTime}}{{/if}}</p><p class="aeris-widget-fcst-period-icon"><img src="{{../paths.wxicons}}{{icon}}" /></p>{{#if ../isHourly}}<p class="aeris-widget-fcst-period-hi">{{#if ../../metric}}{{tempC}}{{else}}{{tempF}}{{/if}}&deg;</p>{{else}}<p class="aeris-widget-fcst-period-hi">{{#if ../../metric}}{{maxTempC}}{{else}}{{maxTempF}}{{/if}}&deg;</p><p class="aeris-widget-fcst-period-lo">{{#if ../../metric}}{{minTempC}}{{else}}{{minTempF}}{{/if}}&deg;</p>{{/if}}</li>{{/forecasts.0.periods}}</ul></div></div></div></div>',helpers:{dayformat:function(e){var h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var g;if(typeof(e)==="string"){var f=e.split(/-|\+|\s+|:|T/);g=new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5],0)}else{g=new Date(e*1000)}return h[g.getDay()].substr(0,3)},hourformat:function(g){if(typeof(g)==="string"){var i=g.split(/-|\+|\s+|:|T/);d=new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5],0)}else{d=new Date(g*1000)}var f=d.getHours();var e=(f>=12)?"p":"a";if(f>12){f-=12}else{if(f===0){f=12}}return(f+e)},periodformat:function(e){}}},opts:{resize:{col:{autocalc:true}}}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES,params:{p:this.params.p}},{endpoint:a.endpoints.FORECASTS,params:c.extend(true,{limit:7},this.params)}],{})},_beforeRender:function(e){e.isHourly=false;e.isDayNight=false;if(e.params.filter){e.isHourly=(e.params.filter!=="day"&&e.params.filter!=="daynight");e.isDayNight=(e.params.filter!=="daynight")}},_afterRender:function(){if(this.opts.resize.col.autocalc===false){return}var g=this.$(".aeris-widget-fcst-periods > ul > li");var h=this.$(".aeris-widget-inner").width();var e=Math.floor(h/g.length);var f=cw=0;if(e>0){a._.each(g,function(i){var j=c(i);cw=e-(j.outerWidth()-j.width());j.css({width:cw});f+=j.outerWidth()})}if(h>0&&f<h){this.$(".aeris-widget-fcst-periods > ul > li:last").css({width:cw+(h-f)})}}});a.widgets.NearbyWeather=a.Widget.extend({prefix:"nearbywx",defaults:{cls:"",tpl:'<div class="aeris-widget-outer aeris-widget-nearbywx"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">Nearby Weather</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul class="aeris-widget-nearbywx-listing">{{#locations}}<li><div class="aeris-widget-nearbywx-name"><a href="{{../links.wxlocal}}?pands={{lower places.place.name}},{{#if places.place.state}}{{lower places.place.state}}{{else}}{{lower places.place.country}}{{/if}}">{{places.place.name}}{{#if places.place.state}}, {{places.place.state}}{{/if}}</a></div><div class="aeris-widget-nearbywx-temp">{{#if ../metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if ../metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-nearbywx-icon"><img src="{{../paths.wxicons}}{{observations.0.ob.icon}}" /></div><div class="aeris-widget-nearbywx-detail">Feels Like {{#if ../metric}}{{observations.0.ob.feelslikeC}}{{else}}{{observations.0.ob.feelslikeF}}{{/if}}&deg;</div>{{#if advisories}}<a class="aeris-widget-nearbywx-alerts" href="{{../../links.wxlocal}}local/{{lower places.place.country}}/{{lower places.place.state}}/{{lower places.place.name}}/warnings.html"><div class="aeris-widget-nearbywx-count">{{advisories.length}}</div><div class="aeris-widget-nearbywx-label">active alerts</div></a>{{/if}}</li>{{/locations}}</ul></div></div></div>'},places:[],placesData:[],setUnits:function(e){if(e!=this.opts.units){this.opts.units=e;this.render({locations:this.placesData})}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Places();this.collection.bind("load",function(g){e.hideLoader();var f=[];e.places.length=0;a._.each(g.models,function(h){e.places.push(h.get("place.name")+","+h.get("place.state")+","+h.get("place.country"));f.push({places:h.toJSON(),observations:[{ob:{icon:"na.png"}}]})});e.render({locations:f});e.placesData=f;e._loadWxData(g)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch(a.actions.CLOSEST,this.params)},_loadWxData:function(k){var l=this;var j={};locData=[];var m=0;for(var h=0,e=this.places.length;h<e;h++){var f=this.places[h];var g=new a.collections.Batch();j[g.cid]=h;g.bind("load",function(o){var n=j[o.cid];var i=a._.extend({},{places:k.at(n).toJSON()},o.toJSON().data);locData[n]=i;m++;if(m===e){l.placesData=locData;l.hideLoader();l.render({locations:locData})}});g.bind("loaderror",function(o,n,i){l.hideLoader();l.showError(i,2000)});g.fetch([{endpoint:a.endpoints.OBS,action:a.actions.ID,params:{p:f}},{endpoint:a.endpoints.ADVISORIES,action:a.actions.ID,params:{p:f}}],{})}}});a.widgets.Advisories=a.Widget.extend({prefix:"advisories",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-advisories"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul class="aeris-widget-advisories-listing">{{#if advisories}}{{#advisories}}<li><p class="aeris-widget-advisories-name">{{ucwords details.name}}</p><p class="aeris-widget-advisories-expires">expires {{dateformat timestamps.expiresISO}}</p><div class="aeris-widget-advisories-icon aeris-widget-advisories-icon-{{alerttype details.type}}"></div></li>{{/advisories}}{{else}}<li class="aeris-widget-error">There are currently no active advisories.</li>{{/if}}</ul></div></div></div>',helpers:{alerttype:function(f){var e="adv";f+="";if(f.match(/\.W$/)){e="warn"}else{if(f.match(/\.A$/)){e="watch"}}return e},dateformat:function(i){var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var f=["January","February","March","April","May","June","July","August","September","October","November","Decemeber"];var k;i+="";if(typeof(i)==="string"){var j=i.split(/-|\+|\s+|:|T/);k=new Date(j[0],j[1]-1,j[2],j[3],j[4],j[5],0)}else{k=new Date(i*1000)}if(!k){return}var h=k.getHours();var g=String("00000"+k.getMinutes()).slice(-2);var e=(h>=12)?"pm":"am";if(h>12){h-=12}if(h===0){h=12}return(l[k.getDay()].substr(0,3)+", "+f[k.getMonth()].substr(0,3)+" "+k.getDate()+" at "+h+":"+g+e)}}}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES,params:{p:this.params.p}},{endpoint:a.endpoints.ADVISORIES,params:c.extend(true,{},this.params)}],{})}});a.widgets.StormReports=a.Widget.extend({prefix:"stmreports",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-stmreports"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}{{> filters}}<div class="aeris-widget-stmreports-listing">{{#if stormreports}}<ul>{{#stormreports}}{{> row}}{{/stormreports}}</ul>{{else}}<div class="aeris-widget-error">No storm reports for the selected type found.</div>{{/if}}</div></div></div>',partials:{row:'<li><div class="aeris-widget-stmreports-icon aeris-widget-stmreports-icon-code-{{report.code}}"></div><div class="aeris-widget-stmreports-profile"><div class="aeris-widget-stmreports-name">{{ucwords report.type}}<span class="aeris-widget-stmreports-total">{{total report.detail metric}}</span></div><div class="aeris-widget-stmreports-details">{{ucwords place.name}}, {{upper place.state}} - {{dateformat report.datetime}}</div></div></li>',filters:'<div class="aeris-widget-stmreports-ctrl"><ul><li class="filter-all"><a>All</a></li><li class="filter-tornado"><a>Tornado</a></li><li class="filter-rain"><a>Rain</a></li><li class="filter-wind"><a>Wind</a></li><li class="filter-snow"><a>Snow</a></li><li class="filter-hail"><a>Hail</a></li><li class="filter-ice"><a>Ice</a></li></ul></div>'},helpers:{total:function(g,f){var e="";g=g||{};if(g.snowIN){e=g.snowIN+'"'}else{if(g.rainIN){e=g.rainIN+'"'}else{if(g.windSpeedMPH){e=g.windSpeedMPH+" mph"}}}return((e!=="")?" - "+e:"")},dateformat:function(o){var k;o+="";if(typeof(o)==="string"){var e=o.split(/-|\+|\s+|:|T/);k=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5],0)}else{k=new Date(o*1000)}var n=k.getFullYear();var g=k.getMonth();var f=k.getDate();var j=k.getHours();var i=k.getMinutes();var l=(j>=12)?"pm":"am";j=(j>12)?j-12:((j===0)?12:j);i=(i<10)?"0"+i:i;return((g+1)+"/"+f+"/"+n+" at "+j+":"+i+l)}}},updates:{target:".aeris-widget-stmreports-listing"},params:{limit:50}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES,params:{p:this.params.p}},{endpoint:a.endpoints.STMREPORTS,action:a.actions.CLOSEST,params:c.extend(true,{limit:50},this.params)}],{})},filter:function(e){this.$(".aeris-widget-stmreports-ctrl li").removeClass("sel");this.$(".aeris-widget-stmreports-ctrl li.filter-"+e).addClass("sel");this.params.filter=(e!="all")?e:null;this.collection.reset();this.load()},_afterRender:function(g){var f=this;var e=this.params.filter||"all";this.$(".aeris-widget-stmreports-ctrl li.filter-"+e).addClass("sel");this.$(".aeris-widget-stmreports-ctrl li").click(function(j){var i=j.currentTarget;var h=c(i).attr("class").replace(/^filter-(\w+)( sel)?$/,"$1");f.filter(h)})},_afterUpdate:function(g){var f=this.view.snippet(".aeris-widget-title");var e=Handlebars.compile(f);var i=e(g);var h=this.$(".aeris-widget-title");if(h.html()!=i){h.fadeOut(100,function(){h.html(e(g));h.fadeIn(100)})}}});a.widgets.TempExtremes=a.Widget.extend({prefix:"currents-compact",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-tempextremes"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{ucwords countries.0.place.name}}</div><div class="aeris-widget-loader-update"></div>{{> toolbar}}</div>{{> search}}{{> error}}<div class="aeris-widget-bottom"><ul><li class="aeris-widget-tempextremes-max"><div class="aeris-widget-tempextremes-label">Highest Temp</div><div class="aeris-widget-tempextremes-icon"></div><div class="aeris-widget-tempextremes-profile">{{#if observations.0.ob}}<div class="aeris-widget-tempextremes-val">{{#if metric}}{{observations.0.ob.tempC}}{{else}}{{observations.0.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-tempextremes-name">{{ucwords observations.0.place.name}}}{{#if observations.0.place.state}}, {{upper observations.0.place.state}}{{/if}}</div>{{else}}<div class="aeris-widget-tempextremes-error">No observation found.</div>{{/if}}</div></li><li class="aeris-widget-tempextremes-min"><div class="aeris-widget-tempextremes-label">Lowest Temp</div><div class="aeris-widget-tempextremes-icon"></div><div class="aeris-widget-tempextremes-profile">{{#if observations.1.ob}}<div class="aeris-widget-tempextremes-val">{{#if metric}}{{observations.1.ob.tempC}}{{else}}{{observations.1.ob.tempF}}{{/if}}&deg;<span class="aeris-widget-unit aeris-widget-unit-temp">{{#if metric}}C{{else}}F{{/if}}</span></div><div class="aeris-widget-tempextremes-name">{{ucwords observations.1.place.name}}{{#if observations.1.place.state}}, {{upper observations.1.place.state}}{{/if}}</div>{{else}}<div class="aeris-widget-tempextremes-error">No observation found.</div>{{/if}}</div></li></ul></div></div></div>',partials:{search:'<div class="aeris-widget-search"><label>Country</label><input type="text" name="aeris-tempextremes-search" /></div>'},helpers:{ucwords:function(e){e=(e+"").toLowerCase();e=e.replace(/,.+$/,"");return(e+"").replace(/^([a-z])|\s+([a-z])|\/([a-z])|(\-[a-z])/g,function(f){return f.toUpperCase()})}}},opts:{country:"us",toolbar:{geolocate:false}}},load:function(){this.showLoader();var f=this;var e="country:"+this.opts.country;if(this.params.query){e+=this.params.query}if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(g){f.hideLoader();f.render(g.toJSON().data)});this.collection.bind("loaderror",function(i,h,g){f.hideLoader();f.showError(g,2000)});this.collection.bind("collectionerror",function(g){})}this.collection.fetch([{endpoint:a.endpoints.OBS,action:a.actions.SEARCH,params:{sort:"temp:-1",limit:1,query:e+",temp:-999"}},{endpoint:a.endpoints.OBS,action:a.actions.SEARCH,params:{sort:"temp",limit:1,query:e+",temp:-999"}},{endpoint:a.endpoints.COUNTRIES,params:{p:this.opts.country}}],{})},_afterRender:function(h){var g=this;var e=this.$(".aeris-widget-bottom > ul > li").width();var f=this.$(".aeris-widget-bottom > ul > li .aeris-widget-tempextremes-icon").outerWidth(true);this.$(".aeris-widget-bottom > ul > li .aeris-widget-tempextremes-profile").width(e-f);if(this.$(".aeris-widget-search").is("*")){var i=new a.collections.Countries();this.$(".aeris-widget-search input").autocomplete({source:function(k,j){i.fetch(a.actions.SEARCH,{query:"name:^"+k.term+";iso:"+k.term+";iso3:"+k.term,limit:10});i.bind("load",function(l){j(c.map(l.toJSON().models,function(m){return{label:m.place.name,value:m.place.iso}}))})},minLength:2,appendTo:this.content,select:function(k,j){if(j.item){g.$(".aeris-widget-search input").val(j.item.label);g.opts.country=j.item.value;g.reload()}}})}}});a.widgets.Records=a.Widget.extend({prefix:"records",defaults:{cls:"",tpl:{container:'<div class="aeris-widget-outer aeris-widget-records"><div class="aeris-widget-inner"><div class="aeris-widget-top"><div class="aeris-widget-title">{{places.0.place.name}}, {{places.0.place.state}}</div><div class="aeris-widget-loader-update"></div><div class="aeris-widget-tbar"><div class="aeris-widget-tbar-ctrls"><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-search"></a><a class="aeris-widget-tbar-btn aeris-widget-tbar-btn-geolocate"></a></div></div></div>{{> search}}{{> error}}{{> filters}}<div class="aeris-widget-records-listing">{{#if records}}<ul>{{#records}}{{> row}}{{/records}}</ul>{{else}}<div class="aeris-widget-error">No records for the selected type found.</div>{{/if}}</div></div></div>',partials:{row:'<li><div class="aeris-widget-records-icon aeris-widget-records-icon-type-{{report.type}}"></div><div class="aeris-widget-records-profile"><div class="aeris-widget-records-name">{{typename report.type}}<span class="aeris-widget-records-total">{{total this this.metric}}</span></div><div class="aeris-widget-records-details">{{ucwords place.name}}, {{upper place.state}} - {{dateformat report.timestamp}}</div></div></li>',filters:'<div class="aeris-widget-records-ctrl"><ul><li class="filter-all"><a>All</a></li><li class="filter-prcp"><a>Precip</a></li><li class="filter-snow"><a>Snow</a></li><li class="filter-maxt"><a>High</a></li><li class="filter-mint"><a>Low</a></li><li class="filter-lomx"><a>Cool High</a></li><li class="filter-himn"><a>Warm Low</a></li></ul></div>'},helpers:{typename:function(e){var f="";if(e=="maxt"){f="High Temp"}else{if(e=="mint"){f="Low Temp"}else{if(e=="prcp"){f="Precip"}else{if(e=="snow"){f="Snow"}else{if(e=="lomx"){f="Cool High Temp"}else{if(e=="himn"){f="Warm Low Temp"}else{f=e}}}}}}return f},total:function(g,f){var e="";g=g||{};if(g.report&&g.report.details){g=g.report.details;if(undefined!==g.snowIN){e=g.snowIN+'"'}else{if(undefined!==g.rainIN){e=g.rainIN+'"'}else{if(undefined!==g.tempF){e=g.tempF+"&deg;F"}}}}return((e!=="")?" - "+e:"")},dateformat:function(f){var i;f+="";if(typeof(f)==="string"&&f.indexOf(":")>-1){var h=f.split(/-|\+|\s+|:|T/);i=new Date(h[0],h[1]-1,h[2],h[3],h[4],h[5],0)}else{i=new Date(f*1000)}var j=i.getFullYear();var e=i.getMonth();var g=i.getDate();return((e+1)+"/"+g+"/"+j)}}},updates:{target:".aeris-widget-records-listing"},params:{limit:50}},load:function(){if(this._geo()){return}this.showLoader();var e=this;if(!this.collection){this.collection=new a.collections.Batch();this.collection.bind("load",function(f){e.hideLoader();e.render(f.toJSON().data)});this.collection.bind("loaderror",function(h,g,f){e.hideLoader();e.showError(f,2000)})}this.collection.fetch([{endpoint:a.endpoints.PLACES,params:{p:this.params.p}},{endpoint:a.endpoints.RECORDS,action:a.actions.CLOSEST,params:this.params}],{})},filter:function(e){this.$(".aeris-widget-records-ctrl li").removeClass("sel");this.$(".aeris-widget-records-ctrl li.filter-"+e).addClass("sel");this.params.filter=(e!="all")?e:null;this.collection.reset();this.load()},_afterRender:function(g){var f=this;var e=this.params.filter||"all";this.$(".aeris-widget-records-ctrl li.filter-"+e).addClass("sel");this.$(".aeris-widget-records-ctrl li").click(function(j){var i=j.currentTarget;var h=c(i).attr("class").replace(/^filter-(\w+)( sel)?$/,"$1");f.filter(h)})},_afterUpdate:function(g){var f=this.view.snippet(".aeris-widget-title");var e=Handlebars.compile(f);var i=e(g);var h=this.$(".aeris-widget-title");if(h.html()!=i){h.fadeOut(100,function(){h.html(e(g));h.fadeIn(100)})}}})}).call(this);